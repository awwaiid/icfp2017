#!/usr/bin/env perl6

use JSON::Fast;

# First ignore the greeting
my $command = from-json(get);

if $command<stop> {
  exit;
}

my $id = $command<state><punter>;

my $rivers = $command<state><map><rivers>;
my $claims = $command<state><claims>;
# $*ERR.say("Rivers: { $rivers.perl }");

my $river = $rivers.pick;
# $*ERR.say("River: { $river.perl }");

say to-json({
  claim => {
    punter => $id,
    source => $river<source>,
    target => $river<target>
  }
}) :!pretty;



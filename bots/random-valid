#!/usr/bin/env perl6

use JSON::Fast;

# First ignore the greeting
my $command = from-json(get);

if $command<stop> {
  exit;
}

my $id = $command<state><punter>;

my $rivers = $command<state><map><rivers>;
my $claims = $command<state><claims>;
# $*ERR.say("Move num: { $command<state><move_num> }");
# $*ERR.say("claims: { $claims.perl }");

my $available-claims = $claims.values.grep({! $^claim<claim>.defined });
# $*ERR.say("Avail: { $available-claims.elems }");

my $river = $available-claims.pick;
# $*ERR.say("River: { $river.perl }");

say to-json({
  claim => {
    punter => $id,
    source => $river<source>,
    target => $river<target>
  }
}) :!pretty;


